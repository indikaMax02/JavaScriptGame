<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D car Game</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

</head>
<body>

<div id="racer">
    <canvas id="canvas">cannot load</canvas>
</div>


<script>

    var fps           = 60;
    var step          = 1/fps;
    var width         = 1024;
    var height        = 768;
    var segments      = [];
    var canvas        = document.getElementById('canvas');
    var ctx           = canvas.getContext('2d');
    var background    = null;
    var sprites       = null;
    var resolution    = null;
    var roadWidth     = 2000;
    var segmentLength = 200;
    var rumbleLength  = 3;
    var trackLength   = null;
    var lanes         = 3;
    var fieldOfView   = 100;
    var cameraHeight  = 1000;
    var cameraDepth   = null;
    var drawDistance  = 300;
    var playerX       = 0;
    var playerZ       = null;
    var fogDensity    = 5;
    var position      = 0;
    var speed         = 0;
    var maxSpeed      = segmentLength/step;
    var accel         = maxSpeed/5;
    var breaking      = -maxSpeed;
    var decel         = -maxSpeed/5;
    var offRoadDecel  = -maxSpeed/2;
    var offRoadLimit  =  maxSpeed/4;

    var keyLeft       = false;
    var keyRight      = false;
    var keyFaster     = false;
    var keySlower     = false;

    //=========================================================================
    // UPDATE THE GAME WORLD
    //=========================================================================
    function update(dt) {

        position = Util.increase(position, dt * speed, trackLength);

        var dx = dt * 2 * (speed/maxSpeed); // at top speed, should be able to cross from left to right
        console.log(dx);
        if (keyLeft)
            playerX = playerX - dx;
        else if (keyRight)
            playerX = playerX + dx;

        if (keyFaster)
            speed = Util.accelerate(speed, accel, dt);
        else if (keySlower)
            speed = Util.accelerate(speed, breaking, dt);
        else
            speed = Util.accelerate(speed, decel, dt);

        if (((playerX < -1) || (playerX > 1)) && (speed > offRoadLimit))
            speed = Util.accelerate(speed, offRoadDecel, dt);

        playerX = Util.limit(playerX, -2, 2);     // dont ever let player go too far out of bounds
        speed   = Util.limit(speed, 0, maxSpeed); // or exceed maxSpeed

    }

</script>


</body>
</html>